<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Dashboard Ultimate Max</title>
    <script src="https://cdn.staticfile.org/tailwindcss/3.3.5/tailwind.min.js"></script>
    <script src="https://cdn.staticfile.org/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            --glass-bg: rgba(255, 255, 255, 0.12);
            --glass-border: rgba(255, 255, 255, 0.25);
            --text-main: #ffffff;
            --dock-bg: rgba(220, 220, 220, 0.25);
            --dock-border: rgba(255, 255, 255, 0.3);
            --widget-bg: rgba(20, 20, 20, 0.2);
        }

        body.dark {
            --glass-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #e0e0e0;
            --dock-bg: rgba(20, 20, 20, 0.8);
            --dock-border: rgba(255, 255, 255, 0.1);
            --widget-bg: rgba(0, 0, 0, 0.6);
        }

        body { 
            margin: 0; font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", "Microsoft YaHei", sans-serif; 
            background: #000; color: var(--text-main); overflow: hidden; user-select: none;
            transition: color 0.3s ease;
        }

        .bg-layer { 
            position: fixed; inset: 0; z-index: -1; 
            background-size: cover; background-position: center; 
            transition: all 0.5s; filter: brightness(0.85); 
        }
        body.dark .bg-layer { filter: brightness(0.5); }
        .bg-layer.zen { transform: scale(1.05); filter: blur(20px); }

        .main-container {
            position: absolute; inset: 0; overflow-y: auto; overflow-x: hidden;
            padding-top: 8vh; padding-bottom: 120px;
            display: flex; flex-direction: column; align-items: center;
        }

        /* 1. 时间 */
        .clock-section { text-align: center; margin-bottom: 30px; text-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        #clock { font-family: 'Helvetica Neue', sans-serif; font-weight: 800; letter-spacing: -2px; font-size: 100px; line-height: 1; }
        .weather-pill {
            display: inline-flex; align-items: center; gap: 8px;
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            padding: 6px 16px; border-radius: 30px; margin-top: 15px;
            font-size: 14px; backdrop-filter: blur(10px);
        }

        /* 2. 搜索框 (Plus Max 版) */
        .search-box {
            width: 90%; max-width: 540px; 
            /* 核心修改：高度由 54px 增加至 64px */
            height: 64px; 
            background: rgba(255, 255, 255, 0.15); /* 稍微加深底色，看起来更厚实 */
            border: 1px solid var(--glass-border);
            border-radius: 32px; /* 圆角适配 */
            display: flex; align-items: center; padding: 0 24px;
            backdrop-filter: blur(25px); transition: 0.3s; margin-bottom: 40px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
        }
        .search-box:focus-within { 
            background: rgba(255,255,255,0.25); border-color: #fff; 
            transform: scale(1.02); box-shadow: 0 12px 40px rgba(0,0,0,0.2); 
        }
        .search-input { 
            width: 100%; background: transparent; border: none; outline: none; 
            color: var(--text-main); font-size: 18px; /* 字体加大 */
            text-align: center; height: 100%; 
        }

        /* 3. 快捷方式 */
        .apps-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(110px, 1fr));
            gap: 16px; width: 100%; max-width: 960px; margin-bottom: 50px; padding: 0 20px;
        }
        .app-card {
            height: 64px; background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 16px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s; backdrop-filter: blur(12px); color: var(--text-main);
            position: relative; overflow: hidden;
        }
        .app-card:hover { background: rgba(255,255,255,0.25); transform: translateY(-3px); box-shadow: 0 5px 15px rgba(0,0,0,0.1); }
        .app-name { font-size: 14px; font-weight: 500; letter-spacing: 0.5px; }

        /* 4. 组件区 */
        .widgets-area {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 24px;
            width: 100%; max-width: 1200px; padding: 0 20px;
        }
        .widget {
            background: var(--widget-bg); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 20px; min-height: 240px;
            display: flex; flex-direction: column; backdrop-filter: blur(30px);
            transition: 0.3s;
        }
        .widget-head { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 12px; font-weight: 700; opacity: 0.8; letter-spacing: 1px; text-transform: uppercase; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 8px; }
        
        .list-item { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; gap: 10px; align-items: center; cursor: pointer; opacity: 0.9; font-size: 13px; transition: 0.2s; }
        .list-item:hover { opacity: 1; padding-left: 6px; background: rgba(255,255,255,0.05); border-radius: 4px; }
        .rank-num { color: #60a5fa; font-weight: bold; width: 18px; text-align: center; }

        /* 极简股票列表 */
        .stock-row { display: flex; justify-content: space-between; align-items: center; padding: 12px 0; border-bottom: 1px solid rgba(255,255,255,0.08); }
        .stock-row:last-child { border: none; }
        .stock-name { font-size: 14px; font-weight: 600; color: #fff; }
        .stock-sub { font-size: 10px; opacity: 0.5; margin-top: 2px; }
        .stock-price { font-size: 14px; font-weight: 500; font-family: monospace; }
        .stock-change { font-size: 12px; padding: 2px 6px; border-radius: 4px; margin-left: 8px; font-weight: bold; }
        .up { color: #ff4d4f; background: rgba(255, 77, 79, 0.15); }
        .down { color: #34c759; background: rgba(52, 199, 89, 0.15); }

        /* 5. Dock 栏 (保持40px低高度) */
        .dock-container {
            position: fixed; bottom: 25px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 50; pointer-events: none;
            padding-bottom: env(safe-area-inset-bottom);
        }
        .dock {
            pointer-events: auto;
            display: flex; align-items: center; justify-content: space-between;
            height: 40px; /* 保持低矮精致 */
            padding: 0 60px;
            gap: 30px; 
            background: var(--dock-bg); border: 1px solid var(--dock-border);
            backdrop-filter: blur(40px); border-radius: 14px; 
            box-shadow: 0 15px 40px rgba(0,0,0,0.2);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 480px;
        }
        .dock-icon {
            width: 22px; height: 22px; 
            display: flex; align-items: center; justify-content: center;
            color: var(--text-main); opacity: 0.8; cursor: pointer; transition: 0.2s;
            position: relative;
        }
        .dock-icon svg { width: 100%; height: 100%; fill: currentColor; filter: drop-shadow(0 2px 3px rgba(0,0,0,0.2)); }
        .dock-icon:hover { transform: scale(1.3) translateY(-4px); opacity: 1; }
        .dock-icon.active { opacity: 1; color: #fff; text-shadow: 0 0 10px rgba(255,255,255,0.8); }
        .dock-sep { width: 1px; height: 16px; background: rgba(255,255,255,0.3); }

        @media (max-width: 768px) {
            #clock { font-size: 60px; }
            .search-box { height: 48px; width: 85%; }
            .widgets-area { grid-template-columns: 1fr; gap: 15px; }
            .dock { padding: 0 20px !important; gap: 20px !important; height: 44px !important; min-width: auto !important; width: 85% !important; bottom: 15px !important; }
            .dock-icon { width: 22px !important; height: 22px !important; }
            .settings-panel { width: 85%; }
        }

        .zen-hidden { opacity: 0; transform: translateY(20px); pointer-events: none; }

        /* 设置面板 */
        .settings-overlay { position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 99; opacity: 0; pointer-events: none; transition: 0.3s; }
        .settings-overlay.open { opacity: 1; pointer-events: auto; }
        .settings-panel { position: fixed; top: 0; right: 0; width: 360px; height: 100%; background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(40px); border-left: 1px solid rgba(255,255,255,0.1); padding: 24px; transform: translateX(100%); transition: transform 0.3s ease; z-index: 100; overflow-y: auto; color: white; }
        .settings-panel.open { transform: translateX(0); }
        .st-group { margin-bottom: 24px; }
        .st-header { font-size: 12px; font-weight: bold; opacity: 0.5; margin-bottom: 10px; text-transform: uppercase; }
        .st-input { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; color: white; outline: none; margin-bottom: 8px; font-size: 13px; }
        .st-btn { width: 100%; background: #3b82f6; color: white; padding: 10px; border-radius: 8px; font-weight: bold; font-size: 12px; text-align: center; cursor: pointer; }
        
        .switch { position: relative; width: 40px; height: 22px; background: rgba(255,255,255,0.2); border-radius: 20px; transition: 0.3s; cursor: pointer; }
        .switch::after { content:''; position: absolute; left: 2px; top: 2px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: 0.3s; }
        .switch.on { background: #3b82f6; }
        .switch.on::after { transform: translateX(18px); }
        
        ::-webkit-scrollbar { display: none; }
    </style>
</head>
<body>

    <div id="mainBg" class="bg-layer" style="background-image: url('https://bing.biturl.top/?resolution=1920&format=image&index=0&mkt=zh-CN');" onclick="toggleZen()"></div>

    <div id="mainUI" class="main-container">
        
        <div class="clock-section">
            <h1 id="clock">00:00</h1>
            <div class="weather-pill">
                <span id="dateStr">Loading...</span>
                <span style="opacity:0.3">|</span>
                <span id="weatherStr">加载天气...</span>
            </div>
        </div>

        <div class="search-box">
            <input id="searchInput" class="search-input" placeholder="Search..." autocomplete="off">
        </div>

        <div id="shortcuts" class="apps-grid"></div>

        <div id="widgets" class="widgets-area">
            <div id="wid-todo" class="widget">
                <div class="widget-head"><span>待办事项</span><span class="cursor-pointer hover:text-blue-400" onclick="addTodo()">+</span></div>
                <input id="todoIn" class="st-input" style="background:transparent;border-bottom:1px solid rgba(255,255,255,0.2);border-radius:0;padding-left:0;" placeholder="输入任务，回车添加..." onkeypress="if(event.key==='Enter') addTodo()">
                <div id="todoList" class="flex-1 overflow-y-auto space-y-1 mt-2 text-sm"></div>
            </div>

            <div id="wid-news" class="widget">
                <div class="widget-head">
                    <span>实时热榜</span>
                    <span id="newsSourceLabel" class="text-[10px] opacity-50 border border-white/30 px-2 rounded cursor-pointer" onclick="toggleSet(true)">切换</span>
                </div>
                <div id="newsList" class="flex-1 overflow-y-auto text-xs space-y-1"></div>
            </div>

            <div id="wid-stock" class="widget">
                <div class="widget-head"><span>行情</span><span class="opacity-50 text-[10px]">LIVE</span></div>
                <div id="stockContainer" class="flex-1 overflow-y-auto"></div>
            </div>
        </div>
    </div>

    <div id="dockWrap" class="dock-container">
        <div class="dock">
            <div class="dock-icon active" onclick="switchTab('main')"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></div>
            <div class="dock-icon" onclick="switchTab('work')"><svg viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/></svg></div>
            <div class="dock-icon" onclick="switchTab('media')"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
            <div class="dock-sep"></div>
            <div class="dock-icon" onclick="toggleZen()"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><circle cx="12" cy="12" r="5"/></svg></div>
            <div class="dock-icon" onclick="toggleSet(true)"><svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></div>
        </div>
    </div>

    <div id="mask" class="settings-overlay" onclick="toggleSet(false)"></div>

    <div id="settings" class="settings-panel">
        <div class="flex justify-between items-center mb-6"><h2 class="text-xl font-bold">设置</h2><button onclick="toggleSet(false)" class="opacity-50 text-xl">✕</button></div>
        <div class="st-group"><div class="st-header">外观</div><div style="display:flex;justify-content:space-between;align-items:center"><span>暗黑模式</span><div id="sw-dark" class="switch" onclick="toggleCfg('dark')"></div></div></div>
        <div class="st-group"><div class="st-header">新闻源</div><select id="newsSel" class="st-input" onchange="changeNews(this.value)"><option value="baidu">百度热搜</option><option value="wb">微博热搜</option><option value="zhihu">知乎热榜</option><option value="36kr">36Kr</option><option value="sspai">少数派</option></select></div>
        <div class="st-group"><div class="st-header">组件开关</div><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><span>待办</span><div id="sw-todo" class="switch" onclick="toggleCfg('showTodo')"></div></div><div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:10px"><span>新闻</span><div id="sw-news" class="switch" onclick="toggleCfg('showNews')"></div></div><div style="display:flex;justify-content:space-between;align-items:center"><span>股票</span><div id="sw-stock" class="switch" onclick="toggleCfg('showStock')"></div></div></div>
        <div class="st-group"><div class="st-header">添加图标</div><input id="appName" class="st-input" placeholder="名称"><input id="appUrl" class="st-input" placeholder="网址"><button onclick="addApp()" class="st-btn">添加</button></div>
        <div class="st-group" style="border:none"><div class="grid grid-cols-2 gap-3"><button onclick="exportData()" class="st-btn bg-green-600">备份</button><label class="st-btn bg-white/10 cursor-pointer">恢复 <input type="file" class="hidden" onchange="importData(this)"></label></div></div>
    </div>

    <script>
        let cfg = {
            dark: false, showTodo: true, showNews: true, showStock: true,
            newsSrc: 'baidu',
            stocks: [
                {n: '上证指数', c: '000001', p: '3,050.12', r: '+0.52%'},
                {n: '纳斯达克', c: 'NDX', p: '16,240.50', r: '+1.20%'},
                {n: '腾讯控股', c: '00700', p: '298.60', r: '-0.85%'}
            ],
            tab: 'main',
            todos: [],
            apps: {
                'main': [{n:'B站',u:'https://bilibili.com'}, {n:'GitHub',u:'https://github.com'}, {n:'ChatGPT',u:'https://chat.openai.com'}],
                'work': [{n:'Gmail',u:'https://mail.google.com'}, {n:'Notion',u:'https://notion.so'}],
                'media': [{n:'YouTube',u:'https://youtube.com'}, {n:'Netflix',u:'https://netflix.com'}]
            }
        };

        function init() {
            const s = localStorage.getItem('dash_clean_v2');
            if (s) cfg = { ...cfg, ...JSON.parse(s) };
            renderUI(); renderApps(); renderTodos(); renderStocks(); loadNews(cfg.newsSrc); startClock();
            new Sortable(document.getElementById('shortcuts'), { animation: 150, onEnd: save });
            document.getElementById('searchInput').addEventListener('keydown', e => {
                if(e.key==='Enter' && e.target.value.trim()) { window.open(`https://www.baidu.com/s?wd=${encodeURIComponent(e.target.value)}`, '_blank'); e.target.value=''; }
            });
        }

        function renderUI() {
            document.body.classList.toggle('dark', cfg.dark);
            document.getElementById('sw-dark').className = `switch ${cfg.dark?'on':''}`;
            document.getElementById('wid-todo').style.display = cfg.showTodo ? 'flex' : 'none';
            document.getElementById('sw-todo').className = `switch ${cfg.showTodo?'on':''}`;
            document.getElementById('wid-news').style.display = cfg.showNews ? 'flex' : 'none';
            document.getElementById('sw-news').className = `switch ${cfg.showNews?'on':''}`;
            document.getElementById('wid-stock').style.display = cfg.showStock ? 'flex' : 'none';
            document.getElementById('sw-stock').className = `switch ${cfg.showStock?'on':''}`;
            const count = (cfg.showTodo?1:0) + (cfg.showNews?1:0) + (cfg.showStock?1:0);
            const area = document.getElementById('widgets');
            if(window.innerWidth > 768) { area.style.gridTemplateColumns = `repeat(${count||1}, 1fr)`; area.style.maxWidth = count===1 ? '500px' : (count===2 ? '900px' : '1200px'); }
            document.getElementById('newsSel').value = cfg.newsSrc;
            const map = {'baidu':'百度','wb':'微博','zhihu':'知乎','36kr':'36Kr','sspai':'少数派'};
            document.getElementById('newsSourceLabel').innerText = map[cfg.newsSrc];
        }

        function toggleCfg(k) { cfg[k] = !cfg[k]; save(); renderUI(); }
        function save() { localStorage.setItem('dash_clean_v2', JSON.stringify(cfg)); }

        function switchTab(t) { cfg.tab = t; document.querySelectorAll('.dock-icon').forEach(e => e.classList.remove('active')); renderApps(); }
        function renderApps() {
            const list = cfg.apps[cfg.tab] || [];
            document.getElementById('shortcuts').innerHTML = list.map((a,i) => `
                <div class="app-card" onclick="window.open('${a.u}')" oncontextmenu="delApp(event, ${i})">
                    <span class="app-name">${a.n}</span>
                </div>
            `).join('');
        }
        function addApp() { const n = document.getElementById('appName').value; const u = document.getElementById('appUrl').value; if(n && u) { cfg.apps[cfg.tab].push({n,u}); save(); renderApps(); } }
        function delApp(e, i) { e.preventDefault(); if(confirm('确定删除此快捷方式吗？')) { cfg.apps[cfg.tab].splice(i,1); save(); renderApps(); } }

        function renderStocks() {
            document.getElementById('stockContainer').innerHTML = cfg.stocks.map(s => `
                <div class="stock-row">
                    <div><div class="stock-name">${s.n}</div><div class="stock-sub">${s.c}</div></div>
                    <div style="text-align:right"><div class="stock-price">${s.p}</div><div class="stock-change ${s.r.startsWith('+')?'up':'down'}">${s.r}</div></div>
                </div>
            `).join('');
        }

        async function loadNews(src) {
            const list = document.getElementById('newsList');
            list.innerHTML = '<div class="text-center opacity-50 mt-4">加载中...</div>';
            const fallbackData = [{title: "网络异常，显示本地演示数据", url:"#"},{title: "SpaceX星舰发射成功", url:"#"},{title: "GPT-5即将发布", url:"#"}];
            try {
                const res = await fetch(`https://api.vvhan.com/api/hotlist?type=${src}&_t=${Date.now()}`);
                const data = await res.json();
                if(data.success && data.data) {
                    list.innerHTML = data.data.slice(0,10).map((n,i)=>`<div class="list-item" onclick="window.open('${n.url}')"><span class="rank-num">${i+1}</span><span class="truncate flex-1">${n.title}</span><span class="text-[10px] opacity-40">${n.hot||''}</span></div>`).join('');
                } else throw new Error();
            } catch(e) {
                list.innerHTML = fallbackData.map((n,i)=>`<div class="list-item opacity-60"><span class="rank-num text-red-400">!</span><span class="truncate flex-1">${n.title}</span></div>`).join('');
            }
        }
        function changeNews(v) { cfg.newsSrc = v; save(); renderUI(); loadNews(v); }

        function startClock() {
            const update = () => {
                const n = new Date();
                document.getElementById('clock').innerText = n.toLocaleTimeString('zh-CN',{hour12:false,hour:'2-digit',minute:'2-digit'});
                document.getElementById('dateStr').innerText = n.toLocaleDateString('zh-CN',{month:'short',day:'numeric',weekday:'short'});
            };
            setInterval(update, 1000); update();
            fetch('https://wttr.in/?format=%c+%t').then(r=>r.text()).then(t=>document.getElementById('weatherStr').innerText=t.trim()).catch(()=>{});
        }

        function renderTodos() {
            document.getElementById('todoList').innerHTML = cfg.todos.map((t,i) => `<div class="list-item"><div class="w-3 h-3 border border-white/50 rounded cursor-pointer" onclick="toggleTodo(${i})">${t.done?'<div class="w-full h-full bg-white scale-75"></div>':''}</div><span class="${t.done?'line-through opacity-30':''} flex-1 truncate text-xs">${t.text}</span><span class="opacity-50 cursor-pointer" onclick="delTodo(${i})">✕</span></div>`).join('');
        }
        function addTodo(){ const v=document.getElementById('todoIn').value; if(v){cfg.todos.push({text:v,done:false});save();renderTodos();document.getElementById('todoIn').value='';} }
        function toggleTodo(i){ cfg.todos[i].done=!cfg.todos[i].done;save();renderTodos(); }
        function delTodo(i){ cfg.todos.splice(i,1);save();renderTodos(); }

        function toggleSet(s) { document.getElementById('settings').classList.toggle('open', s); document.getElementById('mask').classList.toggle('open', s); }
        function toggleZen() {
            const dock = document.getElementById('dockWrap');
            const hidden = dock.style.transform === 'translateY(150%)';
            dock.style.transform = hidden ? 'translateY(0)' : 'translateY(150%)';
            document.querySelector('.bg-layer').classList.toggle('zen', !hidden);
            document.querySelectorAll('#widgets, .search-box, #shortcuts, .clock-section').forEach(e => e.classList.toggle('zen-hidden', !hidden));
        }
        function exportData() { const b=new Blob([JSON.stringify(cfg)],{type:"application/json"}); const a=document.createElement("a"); a.href=URL.createObjectURL(b); a.download="config.json"; a.click(); }
        function importData(inp) { const f=inp.files[0]; if(!f)return; const r=new FileReader(); r.onload=e=>{ try{cfg={...cfg,...JSON.parse(e.target.result)}; save(); location.reload(); }catch(e){} }; r.readAsText(f); }

        window.onload = init;
    </script>
</body>
</html>
