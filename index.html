<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, viewport-fit=cover">
    <title>Ultimate Dashboard</title>
    <script src="https://cdn.staticfile.org/tailwindcss/3.3.5/tailwind.min.js"></script>
    <script src="https://cdn.staticfile.org/Sortable/1.15.0/Sortable.min.js"></script>
    <style>
        :root {
            /* 浅色模式 (默认) */
            --glass-bg: rgba(255, 255, 255, 0.15);
            --glass-border: rgba(255, 255, 255, 0.25);
            --text-main: #ffffff;
            --text-sub: rgba(255, 255, 255, 0.7);
            
            /* Dock 栏 (冰霜白) */
            --dock-bg: rgba(220, 220, 220, 0.4);
            --dock-border: rgba(255, 255, 255, 0.4);
            --dock-icon-default: #ffffff;
            --dock-icon-active: #ffffff;
            
            /* 组件背景 */
            --widget-bg: rgba(30, 30, 30, 0.2);
        }

        /* 暗黑模式 */
        body.dark {
            --glass-bg: rgba(0, 0, 0, 0.5);
            --glass-border: rgba(255, 255, 255, 0.08);
            --text-main: #e0e0e0;
            --text-sub: rgba(255, 255, 255, 0.5);
            --dock-bg: rgba(20, 20, 20, 0.8);
            --dock-border: rgba(255, 255, 255, 0.1);
            --widget-bg: rgba(0, 0, 0, 0.6);
        }

        body { 
            margin: 0; font-family: -apple-system, BlinkMacSystemFont, "PingFang SC", sans-serif; 
            background: #000; color: var(--text-main); overflow: hidden; user-select: none;
            transition: color 0.3s ease;
        }

        /* 壁纸层 */
        .bg-layer { 
            position: fixed; inset: 0; z-index: -1; 
            background-size: cover; background-position: center; 
            transition: all 0.5s; filter: brightness(0.85); 
        }
        body.dark .bg-layer { filter: brightness(0.5); }
        .bg-layer.zen { transform: scale(1.05); filter: blur(20px); }

        /* 主容器 (手机适配关键) */
        .main-container {
            position: absolute; inset: 0; overflow-y: auto; overflow-x: hidden;
            padding: 6vh 20px 140px 20px; /* 底部留出 Dock 空间 */
            display: flex; flex-direction: column; align-items: center;
            transition: opacity 0.3s;
        }

        /* 1. 时间与天气 */
        .clock-section { text-align: center; margin-bottom: 30px; text-shadow: 0 4px 15px rgba(0,0,0,0.3); }
        #clock { 
            font-family: 'Helvetica Neue', sans-serif; font-weight: 800; letter-spacing: -2px; 
            font-size: 100px; line-height: 1;
        }
        .weather-pill {
            display: inline-flex; align-items: center; gap: 8px;
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            padding: 6px 16px; border-radius: 30px; margin-top: 15px;
            font-size: 14px; backdrop-filter: blur(10px);
        }

        /* 2. 搜索框 */
        .search-box {
            width: 100%; max-width: 500px; height: 50px;
            background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 16px; display: flex; align-items: center; padding: 0 20px;
            backdrop-filter: blur(20px); transition: 0.3s; margin-bottom: 40px;
            box-shadow: 0 8px 30px rgba(0,0,0,0.1);
        }
        .search-box:focus-within { background: rgba(255,255,255,0.25); border-color: #fff; transform: scale(1.02); }
        .search-input { width: 100%; background: transparent; border: none; outline: none; color: var(--text-main); font-size: 16px; text-align: center; }

        /* 3. 快捷方式 (手机端自动缩小间距) */
        .apps-grid {
            display: grid; grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 12px; width: 100%; max-width: 900px; margin-bottom: 50px;
        }
        .app-card {
            height: 60px; background: var(--glass-bg); border: 1px solid var(--glass-border);
            border-radius: 14px; display: flex; align-items: center; justify-content: center;
            cursor: pointer; transition: 0.2s; backdrop-filter: blur(12px); color: var(--text-main);
            position: relative;
        }
        .app-card:hover { background: rgba(255,255,255,0.25); transform: translateY(-3px); }
        .app-name { font-size: 13px; font-weight: 500; }
        .del-btn { position: absolute; top: -6px; right: -6px; width: 18px; height: 18px; background: #ff4d4f; color: white; border-radius: 50%; font-size: 12px; display: flex; align-items: center; justify-content: center; opacity: 0; transition: 0.2s; }
        .app-card:hover .del-btn { opacity: 1; }

        /* 4. 底部组件区 (手机端单列) */
        .widgets-area {
            display: grid; grid-template-columns: 1fr 1fr 1fr; gap: 20px;
            width: 100%; max-width: 1200px;
        }
        .widget {
            background: var(--widget-bg); border: 1px solid var(--glass-border);
            border-radius: 20px; padding: 18px; min-height: 240px;
            display: flex; flex-direction: column; backdrop-filter: blur(30px);
            transition: 0.3s;
        }
        .widget-head { display: flex; justify-content: space-between; margin-bottom: 12px; font-size: 12px; font-weight: 700; opacity: 0.8; letter-spacing: 1px; text-transform: uppercase; }
        
        /* 列表项 */
        .list-item { padding: 8px 0; border-bottom: 1px solid rgba(255,255,255,0.05); display: flex; gap: 10px; align-items: center; cursor: pointer; opacity: 0.9; }
        .list-item:hover { opacity: 1; background: rgba(255,255,255,0.05); padding-left: 5px; border-radius: 4px; }
        .rank-num { color: #3b82f6; font-weight: bold; width: 16px; text-align: center; }

        /* --- 手机端适配 (Media Queries) --- */
        @media (max-width: 768px) {
            #clock { font-size: 70px; } /* 时间变小 */
            .main-container { padding-top: 4vh; padding-bottom: 100px; }
            .widgets-area { grid-template-columns: 1fr; } /* 组件变单列 */
            .dock { padding: 0 15px; gap: 15px; height: 50px; min-width: auto; width: 90%; } /* Dock变窄 */
            .dock-icon { width: 28px; height: 28px; }
            .settings-panel { width: 85%; }
        }

        /* --- 5. Dock 栏 (圆角矩形 + 纯净风) --- */
        .dock-container {
            position: fixed; bottom: 20px; left: 0; width: 100%;
            display: flex; justify-content: center; z-index: 50; pointer-events: none;
        }
        .dock {
            pointer-events: auto;
            display: flex; align-items: center; justify-content: space-between;
            background: var(--dock-bg); border: 1px solid var(--dock-border);
            backdrop-filter: blur(40px); border-radius: 16px; /* 圆角矩形 */
            height: 56px; padding: 0 40px; gap: 25px;
            box-shadow: 0 20px 50px rgba(0,0,0,0.3);
            transition: transform 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            min-width: 400px;
        }
        .dock-icon {
            width: 32px; height: 32px; display: flex; align-items: center; justify-content: center;
            color: var(--dock-icon-default); cursor: pointer; transition: 0.2s;
            position: relative;
        }
        .dock-icon svg { width: 100%; height: 100%; fill: currentColor; filter: drop-shadow(0 2px 4px rgba(0,0,0,0.3)); }
        .dock-icon:hover { transform: scale(1.2) translateY(-5px); color: #fff; }
        .dock-icon.active { color: var(--dock-icon-active); }
        .dock-icon.active::after { content:''; position: absolute; bottom: -8px; width: 4px; height: 4px; background: currentColor; border-radius: 50%; }
        .dock-sep { width: 1px; height: 20px; background: rgba(255,255,255,0.3); }

        .zen-hidden { opacity: 0; transform: translateY(20px); pointer-events: none; }

        /* --- 设置面板 --- */
        .settings-overlay {
            position: fixed; inset: 0; background: rgba(0,0,0,0.5); z-index: 99;
            opacity: 0; pointer-events: none; transition: 0.3s;
        }
        .settings-overlay.open { opacity: 1; pointer-events: auto; }
        
        .settings-panel {
            position: fixed; top: 0; right: 0; width: 360px; height: 100%;
            background: rgba(20, 20, 20, 0.95); backdrop-filter: blur(40px);
            border-left: 1px solid rgba(255,255,255,0.1); padding: 24px;
            transform: translateX(100%); transition: transform 0.3s ease; z-index: 100;
            overflow-y: auto; color: white;
        }
        .settings-panel.open { transform: translateX(0); }
        
        .st-group { margin-bottom: 24px; }
        .st-header { font-size: 12px; font-weight: bold; opacity: 0.5; margin-bottom: 10px; text-transform: uppercase; }
        .st-row { display: flex; justify-content: space-between; align-items: center; padding: 12px; background: rgba(255,255,255,0.05); border-radius: 8px; margin-bottom: 8px; font-size: 14px; }
        .st-input { width: 100%; background: rgba(0,0,0,0.3); border: 1px solid rgba(255,255,255,0.1); padding: 10px; border-radius: 8px; color: white; outline: none; margin-bottom: 8px; }
        .st-btn { width: 100%; background: #3b82f6; color: white; padding: 10px; border-radius: 8px; font-weight: bold; font-size: 13px; text-align: center; cursor: pointer; }
        
        /* Toggle Switch */
        .switch { position: relative; width: 40px; height: 22px; background: rgba(255,255,255,0.2); border-radius: 20px; transition: 0.3s; cursor: pointer; }
        .switch::after { content:''; position: absolute; left: 2px; top: 2px; width: 18px; height: 18px; background: white; border-radius: 50%; transition: 0.3s; }
        .switch.on { background: #3b82f6; }
        .switch.on::after { transform: translateX(18px); }
    </style>
</head>
<body>

    <div id="mainBg" class="bg-layer" style="background-image: url('https://bing.biturl.top/?resolution=1920&format=image&index=0&mkt=zh-CN');" onclick="toggleZen()"></div>

    <div id="mainUI" class="main-container">
        
        <div class="clock-section">
            <h1 id="clock">00:00</h1>
            <div class="weather-pill">
                <span id="dateStr">Loading...</span>
                <span style="opacity:0.3">|</span>
                <span id="weatherStr">获取天气...</span>
            </div>
        </div>

        <div class="search-box">
            <input id="searchInput" class="search-input" placeholder="搜索..." autocomplete="off">
        </div>

        <div id="shortcuts" class="apps-grid"></div>

        <div id="widgets" class="widgets-area">
            <div id="wid-todo" class="widget">
                <div class="widget-head"><span>待办事项</span><span class="cursor-pointer hover:text-blue-400" onclick="addTodo()">+</span></div>
                <input id="todoIn" class="st-input" style="background:transparent;border-color:rgba(255,255,255,0.2);padding:6px 0;border-width:0 0 1px 0;border-radius:0;" placeholder="输入任务..." onkeypress="if(event.key==='Enter') addTodo()">
                <div id="todoList" class="flex-1 overflow-y-auto space-y-1 mt-2 text-sm"></div>
            </div>

            <div id="wid-news" class="widget">
                <div class="widget-head">
                    <span>实时热榜</span>
                    <span id="newsSourceLabel" class="text-[10px] opacity-50 border border-white/30 px-2 rounded">百度</span>
                </div>
                <div id="newsList" class="flex-1 overflow-y-auto text-xs space-y-1"></div>
            </div>

            <div id="wid-stock" class="widget">
                <div class="widget-head"><span>市场行情</span><span class="opacity-50 text-[10px]">LIVE</span></div>
                <div id="stockContainer" class="flex-1 overflow-y-auto pr-1"></div>
            </div>
        </div>
    </div>

    <div id="dockWrap" class="dock-container">
        <div class="dock">
            <div class="dock-icon active" onclick="switchTab('main')"><svg viewBox="0 0 24 24"><path d="M10 20v-6h4v6h5v-8h3L12 3 2 12h3v8z"/></svg></div>
            <div class="dock-icon" onclick="switchTab('work')"><svg viewBox="0 0 24 24"><path d="M20 6h-4V4c0-1.11-.89-2-2-2h-4c-1.11 0-2 .89-2 2v2H4c-1.11 0-1.99.89-1.99 2L2 19c0 1.11.89 2 2 2h16c1.11 0 2-.89 2-2V8c0-1.11-.89-2-2-2zm-6 0h-4V4h4v2z"/></svg></div>
            <div class="dock-icon" onclick="switchTab('media')"><svg viewBox="0 0 24 24"><path d="M8 5v14l11-7z"/></svg></div>
            <div class="dock-sep"></div>
            <div class="dock-icon" onclick="toggleZen()"><svg viewBox="0 0 24 24"><path d="M12 2C6.48 2 2 6.48 2 12s4.48 10 10 10 10-4.48 10-10S17.52 2 12 2zm0 18c-4.41 0-8-3.59-8-8s3.59-8 8-8 8 3.59 8 8-3.59 8-8 8z"/><circle cx="12" cy="12" r="5"/></svg></div>
            <div class="dock-icon" onclick="toggleSet(true)"><svg viewBox="0 0 24 24"><path d="M19.14 12.94c.04-.3.06-.61.06-.94 0-.32-.02-.64-.07-.94l2.03-1.58c.18-.14.23-.41.12-.61l-1.92-3.32c-.12-.22-.37-.29-.59-.22l-2.39.96c-.5-.38-1.03-.7-1.62-.94l-.36-2.54c-.04-.24-.24-.41-.48-.41h-3.84c-.24 0-.43.17-.47.41l-.36 2.54c-.59.24-1.13.57-1.62.94l-2.39-.96c-.22-.08-.47 0-.59.22L2.74 8.87c-.12.21-.08.47.12.61l2.03 1.58c-.05.3-.09.63-.09.94s.02.64.07.94l-2.03 1.58c-.18.14-.23.41-.12.61l1.92 3.32c.12.22.37.29.59.22l2.39-.96c.5.38 1.03.7 1.62.94l.36 2.54c.05.24.24.41.48.41h3.84c.24 0 .44-.17.47-.41l.36-2.54c.59-.24 1.13-.58 1.62-.94l2.39.96c.22.08.47 0 .59-.22l1.92-3.32c.12-.22.07-.47-.12-.61l-2.01-1.58zM12 15.6c-1.98 0-3.6-1.62-3.6-3.6s1.62-3.6 3.6-3.6 3.6 1.62 3.6 3.6-1.62 3.6-3.6 3.6z"/></svg></div>
        </div>
    </div>

    <div id="mask" class="settings-overlay" onclick="toggleSet(false)"></div>

    <div id="settings" class="settings-panel">
        <div class="flex justify-between items-center mb-6">
            <h2 class="text-xl font-bold">设置</h2>
            <button onclick="toggleSet(false)" class="opacity-50 text-xl">✕</button>
        </div>

        <div class="st-group">
            <div class="st-header">外观</div>
            <div class="st-row">
                <span>暗黑模式 (Dark Mode)</span>
                <div id="sw-dark" class="switch" onclick="toggleCfg('dark')"></div>
            </div>
        </div>

        <div class="st-group">
            <div class="st-header">新闻设置</div>
            <select id="newsSel" class="st-input" onchange="changeNews(this.value)">
                <option value="baidu">百度热搜</option>
                <option value="wb">微博热搜</option>
                <option value="zhihu">知乎热榜</option>
                <option value="36kr">36Kr</option>
                <option value="sspai">少数派</option>
            </select>
        </div>

        <div class="st-group">
            <div class="st-header">组件开关</div>
            <div class="st-row"><span>待办</span><div id="sw-todo" class="switch" onclick="toggleCfg('showTodo')"></div></div>
            <div class="st-row"><span>新闻</span><div id="sw-news" class="switch" onclick="toggleCfg('showNews')"></div></div>
            <div class="st-row"><span>股票</span><div id="sw-stock" class="switch" onclick="toggleCfg('showStock')"></div></div>
        </div>

        <div class="st-group">
            <div class="st-header">股票代码 (TradingView)</div>
            <div id="stockTags" class="flex flex-wrap gap-2 mb-2"></div>
            <div class="flex gap-2">
                <input id="stockIn" class="st-input mb-0" placeholder="如: BABA, 00700">
                <button onclick="addStock()" class="st-btn w-auto px-4">加</button>
            </div>
        </div>

        <div class="st-group">
            <div class="st-header">添加图标</div>
            <input id="appName" class="st-input" placeholder="名称">
            <input id="appUrl" class="st-input" placeholder="网址">
            <button onclick="addApp()" class="st-btn">添加</button>
        </div>

        <div class="st-group">
            <div class="grid grid-cols-2 gap-3">
                <button onclick="exportData()" class="st-btn bg-green-600">备份</button>
                <label class="st-btn bg-white/10 cursor-pointer">恢复 <input type="file" class="hidden" onchange="importData(this)"></label>
            </div>
        </div>
    </div>

    <script>
        let cfg = {
            dark: false, showTodo: true, showNews: true, showStock: true,
            newsSrc: 'baidu',
            stocks: ['NASDAQ:NDX', 'HK:00700'],
            tab: 'main',
            todos: [],
            apps: {
                'main': [{n:'B站',u:'https://bilibili.com'}, {n:'GitHub',u:'https://github.com'}],
                'work': [{n:'邮箱',u:'https://mail.google.com'}],
                'media': [{n:'Netflix',u:'https://netflix.com'}]
            }
        };

        function init() {
            const s = localStorage.getItem('dash_final');
            if (s) cfg = { ...cfg, ...JSON.parse(s) };
            
            renderUI();
            renderApps();
            renderTodos();
            loadStocks();
            loadNews(cfg.newsSrc);
            startClock();
            
            new Sortable(document.getElementById('shortcuts'), { animation: 150, onEnd: save });
            
            document.getElementById('searchInput').addEventListener('keydown', e => {
                if(e.key==='Enter' && e.target.value.trim()) {
                    window.open(`https://www.baidu.com/s?wd=${encodeURIComponent(e.target.value)}`, '_blank');
                    e.target.value='';
                }
            });
        }

        // 渲染与状态更新
        function renderUI() {
            // 暗黑模式
            document.body.classList.toggle('dark', cfg.dark);
            document.getElementById('sw-dark').className = `switch ${cfg.dark?'on':''}`;
            
            // 组件显隐
            document.getElementById('wid-todo').style.display = cfg.showTodo ? 'flex' : 'none';
            document.getElementById('sw-todo').className = `switch ${cfg.showTodo?'on':''}`;
            document.getElementById('wid-news').style.display = cfg.showNews ? 'flex' : 'none';
            document.getElementById('sw-news').className = `switch ${cfg.showNews?'on':''}`;
            document.getElementById('wid-stock').style.display = cfg.showStock ? 'flex' : 'none';
            document.getElementById('sw-stock').className = `switch ${cfg.showStock?'on':''}`;
            
            // 自动网格
            const count = (cfg.showTodo?1:0) + (cfg.showNews?1:0) + (cfg.showStock?1:0);
            const area = document.getElementById('widgets');
            area.style.gridTemplateColumns = window.innerWidth>768 ? `repeat(${count||1}, 1fr)` : '1fr';
            area.style.maxWidth = count===1 ? '500px' : (count===2 ? '900px' : '1200px');

            // 设置回显
            document.getElementById('newsSel').value = cfg.newsSrc;
            const map = {'baidu':'百度','wb':'微博','zhihu':'知乎','36kr':'36Kr','sspai':'少派'};
            document.getElementById('newsSourceLabel').innerText = map[cfg.newsSrc];
            
            // 股票标签
            document.getElementById('stockTags').innerHTML = cfg.stocks.map((s,i)=>
                `<span class="bg-white/10 px-2 py-1 rounded text-xs flex items-center gap-1">${s}<b class="cursor-pointer text-red-400" onclick="delStock(${i})">×</b></span>`
            ).join('');
        }

        function toggleCfg(k) { cfg[k] = !cfg[k]; save(); renderUI(); }
        function save() { localStorage.setItem('dash_final', JSON.stringify(cfg)); }

        // 快捷方式
        function switchTab(t) {
            cfg.tab = t;
            document.querySelectorAll('.dock-icon').forEach(e => e.classList.remove('active'));
            // 映射active状态...此处略去复杂映射，点击即生效
            renderApps();
        }
        function renderApps() {
            const list = cfg.apps[cfg.tab] || [];
            document.getElementById('shortcuts').innerHTML = list.map((a,i) => `
                <div class="app-card" onclick="window.open('${a.u}')">
                    <span class="app-name">${a.n}</span>
                    <div class="del-btn" onclick="event.stopPropagation(); delApp(${i})">✕</div>
                </div>
            `).join('');
        }
        function addApp() {
            const n = document.getElementById('appName').value;
            const u = document.getElementById('appUrl').value;
            if(n && u) { cfg.apps[cfg.tab].push({n,u}); save(); renderApps(); }
        }
        function delApp(i) { cfg.apps[cfg.tab].splice(i,1); save(); renderApps(); }

        // 待办
        function renderTodos() {
            document.getElementById('todoList').innerHTML = cfg.todos.map((t,i) => `
                <div class="list-item">
                    <div class="w-3 h-3 border border-white/50 rounded cursor-pointer" onclick="toggleTodo(${i})">${t.done?'<div class="w-full h-full bg-white scale-75"></div>':''}</div>
                    <span class="${t.done?'line-through opacity-30':''} flex-1 truncate text-xs">${t.text}</span>
                    <span class="opacity-50 cursor-pointer" onclick="delTodo(${i})">✕</span>
                </div>
            `).join('');
        }
        function addTodo(){ const v=document.getElementById('todoIn').value; if(v){cfg.todos.push({text:v,done:false});save();renderTodos();document.getElementById('todoIn').value='';} }
        function toggleTodo(i){ cfg.todos[i].done=!cfg.todos[i].done;save();renderTodos(); }
        function delTodo(i){ cfg.todos.splice(i,1);save();renderTodos(); }

        // 股票 (纯列表)
        function loadStocks() {
            const c = document.getElementById('stockContainer');
            c.innerHTML = '';
            cfg.stocks.forEach(s => {
                const d = document.createElement('div');
                d.style.height = '60px'; d.style.marginBottom = '5px';
                const w = document.createElement('div'); w.className = 'tradingview-widget-container';
                w.style.width='100%'; w.style.height='100%';
                w.innerHTML = '<div class="tradingview-widget-container__widget"></div>';
                const sc = document.createElement('script');
                sc.src = 'https://s3.tradingview.com/external-embedding/embed-widget-single-quote.js';
                sc.async = true;
                sc.innerHTML = JSON.stringify({ "symbol":s, "width":"100%", "height":"100%", "colorTheme": cfg.dark?"dark":"light", "isTransparent":true, "locale":"zh_CN" });
                w.appendChild(sc); d.appendChild(w); c.appendChild(d);
            });
        }
        function addStock(){ const v=document.getElementById('stockIn').value; if(v){cfg.stocks.push(v);save();renderUI();loadStocks();} }
        function delStock(i){ cfg.stocks.splice(i,1);save();renderUI();loadStocks(); }

        // 新闻 (增强版)
        async function loadNews(src) {
            const list = document.getElementById('newsList');
            list.innerHTML = '<div class="text-center opacity-50 mt-4">加载中...</div>';
            
            // 60s读世界接口 (国内极速)
            const apiUrl = `https://api.vvhan.com/api/hotlist?type=${src}&_=${Date.now()}`;
            
            try {
                const res = await fetch(apiUrl);
                const data = await res.json();
                if(data.success && data.data) {
                    list.innerHTML = data.data.slice(0,10).map((n,i)=>`
                        <div class="list-item" onclick="window.open('${n.url}')">
                            <span class="rank-num">${i+1}</span>
                            <span class="truncate flex-1">${n.title}</span>
                            <span class="text-[10px] opacity-40">${n.hot||''}</span>
                        </div>
                    `).join('');
                } else throw new Error();
            } catch(e) {
                list.innerHTML = `<div class="text-center opacity-50 mt-4 cursor-pointer" onclick="loadNews('${src}')">加载失败，点此重试</div>`;
            }
        }
        function changeNews(v) { cfg.newsSrc = v; save(); renderUI(); loadNews(v); }

        // 天气 & 时间
        function startClock() {
            setInterval(() => {
                const n = new Date();
                document.getElementById('clock').innerText = n.toLocaleTimeString('zh-CN',{hour12:false,hour:'2-digit',minute:'2-digit'});
                document.getElementById('dateStr').innerText = n.toLocaleDateString('zh-CN',{month:'short',day:'numeric',weekday:'short'});
            }, 1000);
            
            // 简单的天气请求 (兼容性好)
            fetch('https://wttr.in/?format=%c+%t')
                .then(r=>r.text())
                .then(t=>document.getElementById('weatherStr').innerText=t.trim())
                .catch(()=>document.getElementById('weatherStr').innerText='暂无天气');
        }

        // 面板控制
        function toggleSet(s) { 
            document.getElementById('settings').classList.toggle('open', s); 
            document.getElementById('mask').classList.toggle('open', s);
        }
        function toggleZen() {
            const dock = document.getElementById('dockWrap');
            const hidden = dock.style.transform === 'translateY(150%)';
            dock.style.transform = hidden ? 'translateY(0)' : 'translateY(150%)';
            document.querySelector('.bg-layer').classList.toggle('zen', !hidden);
            document.querySelectorAll('#widgets, .search-box, #shortcuts, .clock-section').forEach(e => e.classList.toggle('zen-hidden', !hidden));
        }
        
        function exportData() { const b=new Blob([JSON.stringify(cfg)],{type:"application/json"}); const a=document.createElement("a"); a.href=URL.createObjectURL(b); a.download="config.json"; a.click(); }
        function importData(inp) { const f=inp.files[0]; if(!f)return; const r=new FileReader(); r.onload=e=>{ try{cfg={...cfg,...JSON.parse(e.target.result)}; save(); location.reload(); }catch(e){} }; r.readAsText(f); }

        window.onload = init;
    </script>
</body>
</html>
